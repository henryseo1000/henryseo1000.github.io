---
layout: post
title: "[서버 제작 일지 - 1] SSH 서버"
date: 2024-01-10 09:38 +0900
description:
category: Security
tags:
---
[참고 링크](https://jamesbbun.tistory.com/25?category=937696)

서버를 설치하기 위해서는 우분투를 다른 컴퓨터에 설치할 필요가 있는데, 저는 집에 굴러다니던 구형 아이맥에 우분투를 설치했습니다.

혹시 저와 비슷한 방식으로 설치하실 분이 계시다면 위 링크를 참고해주세요.

서버를 돌리는 방법에는 여러가지가 있겠지만, 대표적으로는 2가지가 존재합니다.

 

1. Virtual Box 등 가상 환경에서 돌리기

2. 우분투를 직접 깔아서 돌리기

 

저는 후자의 방법을 택했습니다.
우분투 사이트에 들어가면, 서버를 위한 우분투가 따로 있기는 한데 그냥 GUI도 한 번 써보고 싶어서 그냥 우분투로 깔았습니다.

만약 저와 다른 방식으로 우분투를 설치하시고 싶으시면 그냥 구글링 하시면 됩니다.

이제 SSH 서버를 깔아 원격에서도 컨트롤할 수 있도록 해봅시다.

---

### SSH 패키지 설치하기
~~~shell
sudo apt-get update

sudo apt-get install ssh
~~~
우분투에서 터미널을 열어 위와 같이 입력해주시면 됩니다.

첫 번째 줄의 코드는 apt를 업데이트 하는 명령이고, 두 번째 줄의 코드는 ssh 패키지를 설치하는 명령입니다.

---

### SSH 설정 수정하기
~~~shell
sudo vi /etc/ssh/sshd_config
~~~
위와 같이 입력하면 sshd_config 파일을 확인할 수 있습니다.

특정 줄에 주석(#)이 앞에 있을텐데, 필요한 옵션을 지워주시면 됩니다.

~~~
Port 22
AddressFamily any
ListenAddress 0.0.0.0
ListenAddress ::
~~~
특히 위 부분이 중요한데, Port에는 22번(또는 원하는 포트 번호)을 넣어주시고, ListenAddress에는 0.0.0.0을 넣어 어떤 주소든 연결할 수 있도록 허용해주시면 됩니다.

---

### SSH 실행하기
~~~shell
sudo service ssh start
~~~
위와 같이 실행시켜주고 

~~~shell
service ssh status
~~~
실행 상태를 확인해주시면 됩니다.


위와 같이 왼쪽 위에 초록 색 불과 active(running)이 떠있으면 성공입니다.

---

### 꼭 기억해야 할 것
 

가끔 모두 잘 세팅해주었는데도 원격으로 연결이 되지 않는 경우가 있습니다.

특히 저의 경우는 우분투에서 방화벽이 켜져 있다 보니 서버를 설치해서 돌리는 경우에도 연결이 되지 않는 경우가 많았습니다.

그럴 경우, 2가지 선택지가 있습니다.

 

1. 방화벽 해제 (위험합니다)

2. 방화벽에서 특정 포트만 열어두기

 

1번은 간단히 아래 코드를 입력하면 됩니다. 다만, 방화벽을 해제하면 혹시 외부에서 접속을 허용해 놓았을 때 위험해질 수 있으므로 추천하지 않습니다.

---

### 방화벽 해제
~~~shell
sudo ufw disable
~~~

---

### 방화벽 활성화
~~~shell
sudo ufw enable
~~~
2번은 방화벽으로 하여금 특정 포트만 열어놓도록 하는 것입니다. 아래와 같이 입력하면 됩니다.

~~~shell
sudo ufw allow [허용할 포트 번호]
~~~
그 뒤에 방화벽 상태를 확인해봅니다.

~~~shell
sudo ufw status
~~~

위와 같이 잘 열어두었다면 성공입니다.

---
### SSH 연결하기
 

먼저, 우분투에 할당된 IP 주소를 확인해야 하므로 아래 명령어를 우분투 터미널에 입력해줍니다.

### 내부망에서 할당된 IP 확인을 원하는 경우
~~~shell
hostname -I
~~~

---

### 공인 IP 확인을 원하는 경우
~~~shell
curl ifconfig.me
~~~
참고로, 공인 IP로 접속을 원하는 경우 몇 가지 세팅이 더 필요합니다. 여기에서는 굳이 소개하지 않겠습니다.

위에서 확인된 IP 주소로 접속을 하는 방법은 접속을 원하는 컴퓨터의 터미널을 켜서 아래와 같이 입력해주시면 됩니다.

맥의 경우 fingerprint를 설정하라는 말이 뜰 수 있는데, 그냥 yes를 터미널에 입력하고 비밀번호 입력하셔서 접속하시면 됩니다.

~~~shell
ssh -p [포트 번호] [유저 이름]@[우분투 서버 IP 주소]
~~~

접속 후 위와 같이 뜬다면 성공입니다.

